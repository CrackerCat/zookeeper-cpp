<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.7"/>
<title>zookeeper-cpp: Main Page</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">zookeeper-cpp
   </div>
   <div id="projectbrief">ZooKeeper Client for C++</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.7 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li class="current"><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('index.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Groups</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">zookeeper-cpp Documentation</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>A ZooKeeper client for C++.</p>
<p>Features include (but are not necessarily limited to):</p>
<ul>
<li>Simple<ul>
<li>Connect with just a connection string</li>
<li>Clients should not require factories</li>
<li>Does not require <em>any</em> knowledge of the Java or C APIs</li>
</ul>
</li>
<li>Configurable<ul>
<li>Use the parts you need</li>
<li>Change parts to fit in your application</li>
</ul>
</li>
<li>Safe<ul>
<li>In the best case, illegal code should fail to compile</li>
<li>An illegal action should throw an exception</li>
<li>Utility functions have a <a href="http://www.gotw.ca/gotw/082.htm">strong exception guarantee</a></li>
</ul>
</li>
<li>Stable<ul>
<li>Worry less about upgrading &ndash; the API and ABI will not change out from under you</li>
</ul>
</li>
<li>Documented<ul>
<li>Consumable by human beings</li>
<li>Answers questions you might actually ask</li>
</ul>
</li>
</ul>
<p><b>NOTE</b>: This library is a work-in-progress. All documentation you see here is subject to change and non-existence.</p>
<p><a href="https://travis-ci.org/tgockel/zookeeper-cpp">![Build Status](https://travis-ci.org/tgockel/zookeeper-cpp.svg?branch=master)</a></p>
<h2>Usage</h2>
<p>Ultimately, the usage looks like this (assuming you have a ZooKeeper server running on your local host): </p><pre class="fragment">#include &lt;zk/client.hpp&gt;
#include &lt;zk/multi.hpp&gt;

#include &lt;exception&gt;
#include &lt;iostream&gt;

/** All result types are printable for debugging purposes. **/
template &lt;typename T&gt;
void print_thing(const std::future&lt;T&gt;&amp; result)
{
    try
    {
        // Unwrap the future value, which will not block (based on usage), but could throw.
        T value(result.get());
        std::cerr &lt;&lt; value &lt;&lt; std::endl;
    }
    catch (const std::exception&amp; ex)
    {
        // Error "handling"
        std::cerr &lt;&lt; "Exception: " &lt;&lt; ex.what() &lt;&lt; std::endl;
    }
}

int main()
{
    // zk::client::create returns a future&lt;zk::client&gt;, which is delivered when the connection is established.
    auto client = zk::client::create("zk://127.0.0.1:2181")
                             .get();

    // get_result has a zk::buffer and zk::stat.
    client.get("/foo/bar")
        .then(print_thing&lt;zk::get_result&gt;);

    // get_children_result has a std::vector&lt;std::string&gt; for the path names and zk::stat for the parent stat.
    client.get_children("/foo")
        .then(print_thing&lt;zk::get_children_result&gt;);

    // set_result has a zk::stat for the modified ZNode.
    client.set("/foo/bar", "some data")
        .then(print_thing&lt;zk::set_result&gt;);

    // More explicit: client.create("/foo/baz", "more data", zk::acls::open_unsafe(), zk::create_mode::normal);
    client.create("/foo/baz", "more data")
        .then(print_thing&lt;zk::create_result&gt;);

    client.get("/foo/bar")
        .then([client] (const auto&amp; get_res)
        {
            zk::version foo_bar_version = get_res.get().stat().data_version;

            zk::multi_op txn =
            {
                zk::op::check("/foo", zk::version::any()),
                zk::op::check("/foo/baz", foo_bar_version),
                zk::op::create("/foo/bap", "hi", nullopt, zk::create_mode::sequential),
                zk::op::erase("/foo/bzr"),
            };

            // multi_res's type is zk::future&lt;zk::multi_result&gt;
            client.commit(txn).then(print_thing&lt;zk::multi_result&gt;);
        });

    // This is not strictly needed -- a client falling out of scope will auto-trigger close
    client.close();
}
</pre><h2>Value-Added Features</h2>
<p>The core library of <code>libzkpp</code> provides the primitives for connecting to and manipulating a ZooKeeper database. This library also bundles a number of other features that are commonly required when working with a ZooKeeper cluster.</p>
<h3><code>zk/curator</code></h3>
<p>Things in <code>zk/curator</code> have features found in the <a href="http://curator.apache.org/">Apache Curator</a> project.</p>
<ul>
<li>Elections<ul>
<li><a href="https://github.com/tgockel/zookeeper-cpp/issues/1">Leader Latch</a></li>
<li><a href="https://github.com/tgockel/zookeeper-cpp/issues/2">Leader Election</a></li>
</ul>
</li>
<li>Locks<ul>
<li><a href="https://github.com/tgockel/zookeeper-cpp/issues/3">Shared Reentrant Lock</a></li>
<li><a href="https://github.com/tgockel/zookeeper-cpp/issues/4">Shared Lock</a></li>
<li><a href="https://github.com/tgockel/zookeeper-cpp/issues/5">Shared Reentrant Read Write Lock</a></li>
<li><a href="https://github.com/tgockel/zookeeper-cpp/issues/6">Shared Semaphore</a></li>
<li><a href="https://github.com/tgockel/zookeeper-cpp/issues/7">Multi Shared Lock</a></li>
</ul>
</li>
<li>Barriers<ul>
<li><a href="https://github.com/tgockel/zookeeper-cpp/issues/8">Barrier</a></li>
<li><a href="https://github.com/tgockel/zookeeper-cpp/issues/9">Double Barrier</a></li>
</ul>
</li>
<li>Counters<ul>
<li><a href="https://github.com/tgockel/zookeeper-cpp/issues/10">Shared Counter</a></li>
<li><a href="https://github.com/tgockel/zookeeper-cpp/issues/11">Distributed Atomic Long</a></li>
</ul>
</li>
<li>Caches<ul>
<li><a href="https://github.com/tgockel/zookeeper-cpp/issues/12">Path Cache</a></li>
<li><a href="https://github.com/tgockel/zookeeper-cpp/issues/13">Node Cache</a></li>
<li><a href="https://github.com/tgockel/zookeeper-cpp/issues/14">Tree Cache</a></li>
</ul>
</li>
<li>Nodes<ul>
<li><a href="https://github.com/tgockel/zookeeper-cpp/issues/15">Persistent Node</a></li>
<li><a href="https://github.com/tgockel/zookeeper-cpp/issues/16">Persistent TTL Node</a></li>
<li><a href="https://github.com/tgockel/zookeeper-cpp/issues/17">Group Member</a></li>
</ul>
</li>
</ul>
<p>None of the queue types are planned to be implemented. The <a href="https://cwiki.apache.org/confluence/display/CURATOR/TN4">Curator Documentation (TN4)</a> advises against their use, claiming "it is a bad idea to use ZooKeeper as a Queue." The authors of this library agree with this claim.</p>
<h3><code>zk/fake</code></h3>
<p>This library also provides a fake version of ZooKeeper which operates in-memory. It is meant to be used in your unit testing, when fine-grained control of behavior of ZooKeeper is needed. This allows for the injection of arbitrary behavior into ZK, allowing you to simulate some of the hard-to-reproduce issues like <code><a class="el" href="group__Client.html#gga6521a380e3d01a123e5145fafe9d8d3ca7027d8d5de8fd7cfb33c7d4624378160" title="Watch has been forcefully removed. ">zk::event_type::not_watching</a></code>, <code><a class="el" href="classzk_1_1marshalling__error.html">zk::marshalling_error</a></code>, or timing bugs. It also allows for fast creation and teardown of entire databases, which is commonly done in unit testing.</p>
<p>It is connected to through using a connection string of the form: </p><pre class="fragment">fake://{name}
</pre><p>To use this in unit tests link to <code>libzkpp_fake</code> and use <code>zk::fake::server</code>: </p><pre class="fragment">TEST(my_test)
{
    // The default constructor uses a randomly-generated unique name
    zk::fake::server server;

    // Fetch that name through the connection_string
    zk::client client(server.connection_string());

    // use client normally
}
</pre><h3><code>zk/server</code></h3>
<p>This library controls a ZooKeeper Java process on this machine. It is meant to be used in applications that manage a ZooKeeper cluster from native code.</p>
<h2>Unsupported Functionality</h2>
<p>If you are used to using ZooKeeper via the Java or C APIs, there are a few things that are explicitly not supported in this library.</p>
<h3>Global Watches</h3>
<p>There are two main ways to receive watch notifications: the global watch or through use a watcher objects. In the Java API, the <code>ZooKeeper</code> client allows for a global <a href="https://zookeeper.apache.org/doc/r3.4.10/api/org/apache/zookeeper/Watcher.html">Watcher</a>. In the C API, <code>zookeeper_init</code> can be provided with a global function with the signature <code>void (*)(zhandle_t* zh, int type, int state, const char* path, void* watcherCtx)</code> to achieve this same result. The ZooKeeper community considers global watches as "legacy" and prefers the use of watcher objects set on a per-path basis. As such, global watches are <em>not</em> supported by this library.</p>
<h3>Synchronous API</h3>
<p>The C library offers both a synchronous and an asynchronous API. This library offers only an asynchronous version. If you prefer a synchronous API, call <code>get()</code> on the returned <code>future</code> to block until you receive the response.</p>
<h3>Non-Linux</h3>
<p>Can you get this library working on platforms that are not Linux? Maybe. But Linux is the primary development, testing, and deployment platform of people writing distributed applications, so this library is targetted at Linux.</p>
<h2>License</h2>
<p>Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with the License. You may obtain a copy of the License at <a href="http://www.apache.org/licenses/LICENSE-2.0">http://www.apache.org/licenses/LICENSE-2.0</a>.</p>
<p>Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License.</p>
<h2>F.A.Q.</h2>
<h3>Why <code>erase</code> instead of <code>delete</code>?</h3>
<p>In the Java and C APIs, the act of removing a ZNode is called <code>delete</code> and <code>zoo_delete</code>, respectively. However, <code>delete</code> is a C++ keyword and cannot be used as a member function. So, this library uses <code>erase</code>, which falls in line with standard C++ containers. Alternatives such as calling the operation <code>delete_</code> look a bit worse (in the author's opinion).</p>
<h3>Why are watch calls separate?</h3>
<p>In the Java and C APIs, adding a watch to a ZNode is an additional parameter to the <code>get</code>, <code>get_children</code>, or <code>exists</code> calls while this library uses separate <code>watch</code>, <code>watch_children</code>, and <code>watch_exists</code> calls. This is done because the return types are different between a simple fetch and setting a watch. While <code>get</code> returns a <code>future&lt;get_result&gt;</code>, <code>watch</code> returns the slightly more complicated <code>future&lt;watch_result&gt;</code>. The <code>future</code> in <code>watch_result::next()</code> would be disabled in cases where a flag is not set, and it would be ignored with the majority of use cases. This leads to an awkward API for simple calls.</p>
<p>An alternative used by other libraries is to provide a <code>std::function</code>, implying to not watch when the function is not passed in. This has a number of disadvantages:</p>
<ul>
<li>There is no good way to cancel a watch without giving an extra parameter. With a <code>future</code>, you simply let it fall out of scope.</li>
<li>Watches are delivered only once, which is obvious from a <code>future</code>-like API, but not obvious from a <code>function</code>-like API.</li>
<li>It is not obvious what the behavior should be if the original call returns in error. With a <code>future</code>, the behavior is obvious, since you never receive the mechanisms to perform the watch.</li>
</ul>
<p>In Java, the method of choice is to use the <a href="https://zookeeper.apache.org/doc/r3.4.10/api/org/apache/zookeeper/Watcher.html">Watcher</a> interface, but this feels extremely out of place in C++ code.</p>
<h3>How can I contribute?</h3>
<p>Pick an <a href="https://github.com/tgockel/zookeeper-cpp/issues">open issue</a> and start working on it! For more details, read the <a href="https://github.com/tgockel/zookeeper-cpp/blob/master/CONTRIBUTING.rst">CONTRIBUTING</a> guide. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.7 </li>
  </ul>
</div>
</body>
</html>
